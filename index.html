<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>极速卡网 - 带后台管理系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Arial", sans-serif;
        }
        :root {
            --primary: #165DFF;
            --danger: #E74C3C;
            --success: #27AE60;
            --warning: #F39C12;
            --gray-100: #F8F9FA;
            --gray-200: #E9ECEF;
            --gray-600: #6C757D;
            --gray-900: #212529;
            --white: #FFFFFF;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
            --radius: 8px;
        }
        body {
            background: var(--gray-100);
            padding-top: 70px;
            padding-bottom: 80px;
        }
        /* 顶部导航 */
        .header {
            background: var(--white);
            box-shadow: var(--shadow);
            padding: 15px 20px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 999;
        }
        .logo {
            font-size: 22px;
            font-weight: 700;
            color: var(--primary);
        }
        .nav-btns {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .btn {
            padding: 8px 16px;
            border-radius: var(--radius);
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }
        .btn-primary:hover {
            background: #0F52D9;
        }
        .btn-default {
            background: var(--gray-200);
            color: #333;
        }
        .btn-default:hover {
            background: #ddd;
        }
        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }
        .btn-danger:hover {
            background: #c0392b;
        }
        .btn-success {
            background: var(--success);
            color: var(--white);
        }
        .btn-warning {
            background: var(--warning);
            color: var(--white);
        }
        .cart-btn {
            position: relative;
            background: var(--primary);
            color: var(--white);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
        }
        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: var(--white);
            font-size: 12px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        /* 主内容区 */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        .notice {
            background: #FFF3CD;
            border-radius: var(--radius);
            padding: 12px 20px;
            margin: 20px 0;
            color: #856404;
            font-size: 14px;
        }
        /* 商品展示 */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .product-card {
            background: var(--white);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.2s;
        }
        .product-card:hover {
            transform: translateY(-3px);
        }
        .product-img {
            width: 100%;
            height: 140px;
            object-fit: cover;
        }
        .product-info {
            padding: 15px;
        }
        .product-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .product-price {
            color: var(--danger);
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 12px;
        }
        .add-cart {
            width: 100%;
            padding: 8px;
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 14px;
        }
        .add-cart:hover {
            background: #0F52D9;
        }
        .add-cart:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        /* 模态框通用样式 */
        .modal-mask {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none;
        }
        .modal {
            background: var(--white);
            border-radius: var(--radius);
            width: 90%;
            max-width: 600px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .modal-lg {
            max-width: 900px;
        }
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--gray-200);
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-size: 14px;
            color: var(--gray-600);
        }
        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--radius);
            font-size: 14px;
        }
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        .form-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--radius);
            font-size: 14px;
            background: var(--white);
        }
        .modal-footer {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        .modal-footer .btn {
            flex: none;
        }
        .error-tip {
            color: var(--danger);
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        /* 个人中心 */
        .user-center {
            max-width: 600px;
            margin: 30px auto;
            background: var(--white);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            display: none;
        }
        .user-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }
        .auth-status {
            text-align: center;
            margin-bottom: 20px;
            font-size: 16px;
            color: var(--danger);
        }
        /* 后台管理样式 */
        .admin-container {
            max-width: 1200px;
            margin: 30px auto;
            background: var(--white);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            display: none;
        }
        .admin-tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-200);
            margin-bottom: 20px;
        }
        .admin-tab {
            padding: 10px 20px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-right: 10px;
        }
        .admin-tab.active {
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }
        .admin-content {
            display: none;
        }
        .admin-content.active {
            display: block;
        }
        /* 表格样式 */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }
        .data-table th {
            background: var(--gray-100);
            font-weight: 600;
        }
        .table-actions {
            display: flex;
            gap: 8px;
        }
        .table-actions .btn {
            padding: 4px 10px;
            font-size: 12px;
        }
        .status-tag {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: var(--white);
        }
        .status-normal {
            background: var(--success);
        }
        .status-disabled {
            background: var(--gray-600);
        }
        .status-pending {
            background: var(--warning);
        }
        .status-paid {
            background: var(--success);
        }
        .status-canceled {
            background: var(--danger);
        }
        /* 搜索栏 */
        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .search-bar .form-input {
            flex: 1;
            max-width: 300px;
        }
        /* 音乐播放器 */
        .music-player {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--white);
            padding: 10px 20px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 998;
        }
        .music-btn {
            background: transparent;
            border: none;
            color: var(--primary);
            font-size: 20px;
            cursor: pointer;
        }
        .music-progress {
            flex: 1;
            height: 4px;
            background: #eee;
            border-radius: 2px;
        }
        .progress-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
        }
        /* 响应式 */
        @media (max-width: 768px) {
            .product-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            .btn span {
                display: none;
            }
            .admin-tabs {
                overflow-x: auto;
                white-space: nowrap;
            }
            .data-table th, .data-table td {
                padding: 8px 10px;
                font-size: 12px;
            }
            .table-actions .btn {
                padding: 2px 6px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- 顶部导航 -->
    <div class="header">
        <div class="logo">极速卡网</div>
        <div class="nav-btns" id="guestNav">
            <button class="btn btn-default" id="loginBtn">登录</button>
            <button class="btn btn-primary" id="registerBtn">注册</button>
            <div class="cart-btn" id="cartBtn">
                <i class="fas fa-shopping-cart"></i>
                <span class="cart-badge">0</span>
            </div>
        </div>
        <div class="nav-btns" id="userNav" style="display: none;">
            <button class="btn btn-default" id="userCenterBtn">个人中心</button>
            <button class="btn btn-default" id="adminBtn" style="display: none;">后台管理</button>
            <button class="btn btn-default" id="logoutBtn">退出</button>
            <div class="cart-btn" id="userCartBtn">
                <i class="fas fa-shopping-cart"></i>
                <span class="cart-badge">0</span>
            </div>
        </div>
    </div>

    <!-- 主内容区 -->
    <div class="container" id="mainContent">
        <div class="notice" id="systemNotice">
            【限时优惠】所有商品8折起，新用户注册即送10元优惠券！
        </div>

        <!-- 商品展示 -->
        <div class="product-grid" id="productGrid">
            <div class="product-card">
                <img src="https://picsum.photos/300/200?1" alt="视频会员" class="product-img">
                <div class="product-info">
                    <div class="product-name">腾讯视频会员1个月</div>
                    <div class="product-price">¥15.90</div>
                    <button class="add-cart" data-id="1" data-name="腾讯视频会员1个月" data-price="15.90" data-img="https://picsum.photos/300/200?1" data-category="视频会员">加入购物车</button>
                </div>
            </div>
            <div class="product-card">
                <img src="https://picsum.photos/300/200?2" alt="音乐会员" class="product-img">
                <div class="product-info">
                    <div class="product-name">网易云音乐会员1个月</div>
                    <div class="product-price">¥12.90</div>
                    <button class="add-cart" data-id="2" data-name="网易云音乐会员1个月" data-price="12.90" data-img="https://picsum.photos/300/200?2" data-category="音乐会员">加入购物车</button>
                </div>
            </div>
            <div class="product-card">
                <img src="https://picsum.photos/300/200?3" alt="游戏充值" class="product-img">
                <div class="product-info">
                    <div class="product-name">王者荣耀100点券</div>
                    <div class="product-price">¥9.90</div>
                    <button class="add-cart" data-id="3" data-name="王者荣耀100点券" data-price="9.90" data-img="https://picsum.photos/300/200?3" data-category="游戏充值">加入购物车</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 后台管理系统 -->
    <div class="admin-container" id="adminContainer">
        <div class="admin-tabs">
            <div class="admin-tab active" data-tab="user">用户管理</div>
            <div class="admin-tab" data-tab="product">商品管理</div>
            <div class="admin-tab" data-tab="order">订单管理</div>
            <div class="admin-tab" data-tab="system">系统设置</div>
        </div>

        <!-- 用户管理 -->
        <div class="admin-content active" id="userManage">
            <div class="search-bar">
                <input type="text" class="form-input" id="userSearch" placeholder="搜索用户名...">
                <button class="btn btn-primary" id="searchUserBtn">搜索</button>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>用户名</th>
                        <th>注册时间</th>
                        <th>实名认证</th>
                        <th>账号状态</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="userTableBody">
                    <!-- 用户数据动态渲染 -->
                </tbody>
            </table>
        </div>

        <!-- 商品管理 -->
        <div class="admin-content" id="productManage">
            <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                <div class="search-bar">
                    <input type="text" class="form-input" id="productSearch" placeholder="搜索商品名称...">
                    <button class="btn btn-primary" id="searchProductBtn">搜索</button>
                </div>
                <button class="btn btn-success" id="addProductBtn">新增商品</button>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>商品名称</th>
                        <th>分类</th>
                        <th>销售价格</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="productTableBody">
                    <!-- 商品数据动态渲染 -->
                </tbody>
            </table>
        </div>

        <!-- 订单管理 -->
        <div class="admin-content" id="orderManage">
            <div class="search-bar">
                <input type="text" class="form-input" id="orderSearch" placeholder="搜索订单号/用户名...">
                <button class="btn btn-primary" id="searchOrderBtn">搜索</button>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>订单号</th>
                        <th>用户名</th>
                        <th>商品列表</th>
                        <th>订单总价</th>
                        <th>创建时间</th>
                        <th>订单状态</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="orderTableBody">
                    <!-- 订单数据动态渲染 -->
                </tbody>
            </table>
        </div>

        <!-- 系统设置 -->
        <div class="admin-content" id="systemManage">
            <form id="systemSettingForm">
                <div class="form-group">
                    <label class="form-label">系统公告</label>
                    <input type="text" class="form-input" id="systemNoticeInput" placeholder="输入系统公告内容">
                </div>
                <div class="form-group">
                    <label class="form-label">默认商品折扣（%）</label>
                    <input type="number" class="form-input" id="defaultDiscount" min="1" max="100" placeholder="输入折扣比例（如80代表8折）">
                </div>
                <div class="form-group">
                    <label class="form-label">管理员密码修改</label>
                    <input type="password" class="form-input" id="adminNewPwd" placeholder="输入新密码（留空不修改）">
                </div>
                <button type="submit" class="btn btn-primary">保存设置</button>
            </form>
        </div>
    </div>

    <!-- 所有模态框 -->
    <!-- 登录模态框 -->
    <div class="modal-mask" id="loginMask">
        <div class="modal">
            <div class="modal-title">用户登录</div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">用户名</label>
                    <input type="text" class="form-input" id="loginUsername" placeholder="输入用户名" required>
                    <div class="error-tip" id="loginUserError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">密码</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="输入密码" required>
                    <div class="error-tip" id="loginPwdError"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" id="cancelLoginBtn">取消</button>
                    <button type="submit" class="btn btn-primary">登录</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 注册模态框 -->
    <div class="modal-mask" id="registerMask">
        <div class="modal">
            <div class="modal-title">账号注册</div>
            <form id="registerForm">
                <div class="form-group">
                    <label class="form-label">用户名</label>
                    <input type="text" class="form-input" id="registerUsername" placeholder="3-20位字母/数字/下划线" required>
                    <div class="error-tip" id="regUserError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">密码</label>
                    <input type="password" class="form-input" id="registerPassword" placeholder="6-16位字母+数字组合" required>
                    <div class="error-tip" id="regPwdError"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" id="cancelRegisterBtn">取消</button>
                    <button type="submit" class="btn btn-primary">注册</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 购物车模态框 -->
    <div class="modal-mask" id="cartMask">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-title">我的购物车</div>
            <div id="cartList" style="max-height: 300px; overflow-y: auto;">
                <div style="text-align: center; padding: 50px 0; color: var(--gray-600);">
                    购物车为空，快去选购商品吧～
                </div>
            </div>
            <div style="margin-top: 20px; text-align: right; font-size: 16px; font-weight: 600;">
                总计：¥<span id="cartTotal">0.00</span>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" id="closeCartBtn">关闭</button>
                <button type="button" class="btn btn-primary" id="checkoutBtn">结算</button>
            </div>
        </div>
    </div>

    <!-- 个人中心 -->
    <div class="user-center" id="userCenterPage">
        <div class="user-title">个人中心</div>
        <div class="auth-status" id="authStatus">未实名认证（需完成认证才能使用全部功能）</div>
        <form id="authForm">
            <div class="form-group">
                <label class="form-label">真实姓名</label>
                <input type="text" class="form-input" id="authRealName" placeholder="请输入真实姓名" required>
            </div>
            <div class="form-group">
                <label class="form-label">身份证号</label>
                <input type="text" class="form-input" id="authIdCard" placeholder="请输入18位身份证号" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">提交实名认证</button>
        </form>
    </div>

    <!-- 新增/编辑商品模态框 -->
    <div class="modal-mask" id="productModal">
        <div class="modal">
            <div class="modal-title" id="productModalTitle">新增商品</div>
            <form id="productForm">
                <input type="hidden" id="productId">
                <div class="form-group">
                    <label class="form-label">商品名称</label>
                    <input type="text" class="form-input" id="productName" placeholder="输入商品名称" required>
                </div>
                <div class="form-group">
                    <label class="form-label">商品分类</label>
                    <select class="form-select" id="productCategory" required>
                        <option value="视频会员">视频会员</option>
                        <option value="音乐会员">音乐会员</option>
                        <option value="游戏充值">游戏充值</option>
                        <option value="云存储">云存储</option>
                        <option value="其他">其他</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">销售价格</label>
                    <input type="number" step="0.01" class="form-input" id="productPrice" placeholder="输入销售价格" required>
                </div>
                <div class="form-group">
                    <label class="form-label">商品图片URL</label>
                    <input type="url" class="form-input" id="productImg" placeholder="输入图片链接" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" id="cancelProductBtn">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 订单详情模态框 -->
    <div class="modal-mask" id="orderDetailModal">
        <div class="modal modal-lg">
            <div class="modal-title">订单详情</div>
            <div id="orderDetailContent" style="max-height: 400px; overflow-y: auto;">
                <!-- 订单详情动态渲染 -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" id="closeOrderDetailBtn">关闭</button>
                <button type="button" class="btn btn-primary" id="updateOrderStatusBtn">更新状态</button>
            </div>
        </div>
    </div>

    <!-- 音乐播放器 -->
    <div class="music-player">
        <button class="music-btn" id="playMusicBtn">
            <i class="fas fa-play"></i>
        </button>
        <div class="music-progress">
            <div class="progress-fill" id="musicProgressFill"></div>
        </div>
        <input type="file" id="musicFile" style="display: none;" accept="audio/*">
        <button class="music-btn" id="uploadMusicBtn">
            <i class="fas fa-upload"></i>
        </button>
    </div>

    <script>
        // 全局变量（本地存储核心数据）
        let isLogin = false;
        let isAuthed = false;
        let isAdmin = false;
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let users = JSON.parse(localStorage.getItem('cardNetworkUsers')) || [];
        let products = JSON.parse(localStorage.getItem('cardNetworkProducts')) || [];
        let orders = JSON.parse(localStorage.getItem('cardNetworkOrders')) || [];
        let systemConfig = JSON.parse(localStorage.getItem('cardNetworkSystem')) || {
            notice: '【限时优惠】所有商品8折起，新用户注册即送10元优惠券！',
            discount: 80,
            adminPwd: 'admin123' // 默认管理员密码
        };
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let currentOrderId = ''; // 当前操作的订单ID
        let audio = new Audio();

        // 初始化管理员账号（首次使用自动创建）
        function initAdmin() {
            const adminExists = users.some(u => u.username === 'admin');
            if (!adminExists) {
                users.push({
                    username: 'admin',
                    password: systemConfig.adminPwd,
                    isAuthed: true,
                    realName: '管理员',
                    idCard: '111111111111111111',
                    status: 'normal',
                    createTime: new Date().toLocaleString()
                });
                localStorage.setItem('cardNetworkUsers', JSON.stringify(users));
            }
            // 初始化商品数据
            if (products.length === 0) {
                products = [
                    { id: '1', name: '腾讯视频会员1个月', category: '视频会员', price: 15.90, img: 'https://picsum.photos/300/200?1' },
                    { id: '2', name: '网易云音乐会员1个月', category: '音乐会员', price: 12.90, img: 'https://picsum.photos/300/200?2' },
                    { id: '3', name: '王者荣耀100点券', category: '游戏充值', price: 9.90, img: 'https://picsum.photos/300/200?3' }
                ];
                localStorage.setItem('cardNetworkProducts', JSON.stringify(products));
            }
            // 更新系统公告
            document.getElementById('systemNotice').textContent = systemConfig.notice;
        }

        // DOM元素
        const guestNav = document.getElementById('guestNav');
        const userNav = document.getElementById('userNav');
        const adminBtn = document.getElementById('adminBtn');
        const adminContainer = document.getElementById('adminContainer');
        const mainContent = document.getElementById('mainContent');
        const loginBtn = document.getElementById('loginBtn');
        const registerBtn = document.getElementById('registerBtn');
        const cartBtn = document.getElementById('cartBtn');
        const userCenterBtn = document.getElementById('userCenterBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const userCartBtn = document.getElementById('userCartBtn');
        const userCenterPage = document.getElementById('userCenterPage');
        const loginMask = document.getElementById('loginMask');
        const registerMask = document.getElementById('registerMask');
        const cartMask = document.getElementById('cartMask');
        const cancelLoginBtn = document.getElementById('cancelLoginBtn');
        const cancelRegisterBtn = document.getElementById('cancelRegisterBtn');
        const closeCartBtn = document.getElementById('closeCartBtn');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const cartList = document.getElementById('cartList');
        const cartTotal = document.getElementById('cartTotal');
        const authStatus = document.getElementById('authStatus');
        const playMusicBtn = document.getElementById('playMusicBtn');
        const uploadMusicBtn = document.getElementById('uploadMusicBtn');
        const musicFile = document.getElementById('musicFile');
        const musicProgressFill = document.getElementById('musicProgressFill');

        // 后台管理元素
        const adminTabs = document.querySelectorAll('.admin-tab');
        const adminContents = document.querySelectorAll('.admin-content');
        const userTableBody = document.getElementById('userTableBody');
        const productTableBody = document.getElementById('productTableBody');
        const orderTableBody = document.getElementById('orderTableBody');
        const addProductBtn = document.getElementById('addProductBtn');
        const productModal = document.getElementById('productModal');
        const cancelProductBtn = document.getElementById('cancelProductBtn');
        const productForm = document.getElementById('productForm');
        const orderDetailModal = document.getElementById('orderDetailModal');
        const closeOrderDetailBtn = document.getElementById('closeOrderDetailBtn');
        const updateOrderStatusBtn = document.getElementById('updateOrderStatusBtn');
        const systemSettingForm = document.getElementById('systemSettingForm');
        const systemNoticeInput = document.getElementById('systemNoticeInput');
        const defaultDiscount = document.getElementById('defaultDiscount');
        const adminNewPwd = document.getElementById('adminNewPwd');

        // 页面加载初始化
        window.onload = function() {
            initAdmin();
            // 检查登录状态
            if (currentUser) {
                isLogin = true;
                isAuthed = currentUser.isAuthed || false;
                isAdmin = currentUser.username === 'admin';
                updateLoginStatus();
                // 管理员加载后台数据
                if (isAdmin) {
                    renderUserTable();
                    renderProductTable();
                    renderOrderTable();
                    initSystemSetting();
                }
            }
            // 渲染购物车和商品列表
            renderCart();
            renderProductGrid();
            // 绑定商品加入购物车事件
            bindAddCartEvents();
            // 绑定后台标签切换事件
            bindAdminTabEvents();
        };

        // 更新登录状态
        function updateLoginStatus() {
            guestNav.style.display = 'none';
            userNav.style.display = 'flex';
            // 显示/隐藏后台管理按钮
            adminBtn.style.display = isAdmin ? 'block' : 'none';
            // 更新认证状态显示
            if (isAuthed) {
                authStatus.textContent = `已实名认证（${currentUser.realName}）`;
                authStatus.style.color = '#27AE60';
                // 启用购物功能
                document.querySelectorAll('.add-cart').forEach(btn => {
                    btn.disabled = false;
                });
                userCartBtn.style.pointerEvents = 'auto';
                userCartBtn.style.opacity = '1';
            } else {
                // 禁用购物功能
                document.querySelectorAll('.add-cart').forEach(btn => {
                    btn.disabled = true;
                });
                userCartBtn.style.pointerEvents = 'none';
                userCartBtn.style.opacity = '0.5';
            }
        }

        // 1. 登录相关
        loginBtn.addEventListener('click', () => {
            loginMask.style.display = 'flex';
        });
        cancelLoginBtn.addEventListener('click', () => {
            loginMask.style.display = 'none';
        });
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            const userError = document.getElementById('loginUserError');
            const pwdError = document.getElementById('loginPwdError');

            if (!username) {
                userError.textContent = '请输入用户名';
                userError.style.display = 'block';
                return;
            }
            if (!password) {
                pwdError.textContent = '请输入密码';
                pwdError.style.display = 'block';
                return;
            }

            // 查找用户
            const user = users.find(u => u.username === username && u.password === password);
            if (user) {
                alert('登录成功');
                currentUser = user;
                isLogin = true;
                isAuthed = user.isAuthed || false;
                isAdmin = username === 'admin';
                // 保存到本地存储
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                loginMask.style.display = 'none';
                updateLoginStatus();
                // 管理员加载后台数据
                if (isAdmin) {
                    renderUserTable();
                    renderProductTable();
                    renderOrderTable();
                    initSystemSetting();
                }
            } else {
                alert('用户名或密码错误');
            }
        });

        // 2. 注册相关
        registerBtn.addEventListener('click', () => {
            registerMask.style.display = 'flex';
        });
        cancelRegisterBtn.addEventListener('click', () => {
            registerMask.style.display = 'none';
        });
        document.getElementById('registerForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value.trim();
            const userError = document.getElementById('regUserError');
            const pwdError = document.getElementById('regPwdError');

            // 前端校验
            if (!/^[a-zA-Z0-9_]{3,20}$/.test(username)) {
                userError.textContent = '用户名需为3-20位字母/数字/下划线';
                userError.style.display = 'block';
                return;
            }
            if (!/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z0-9]{6,16}$/.test(password)) {
                pwdError.textContent = '密码需为6-16位字母+数字组合';
                pwdError.style.display = 'block';
                return;
            }

            // 检查用户名是否已存在
            const userExists = users.some(u => u.username === username);
            if (userExists) {
                alert('用户名已被占用');
                return;
            }

            // 新增用户
            const newUser = {
                username,
                password,
                isAuthed: false,
                realName: '',
                idCard: '',
                status: 'normal', // normal/disabled
                createTime: new Date().toLocaleString()
            };
            users.push(newUser);
            // 保存到本地存储
            localStorage.setItem('cardNetworkUsers', JSON.stringify(users));
            alert('注册成功，请登录');
            registerMask.style.display = 'none';
        });

        // 3. 退出登录
        logoutBtn.addEventListener('click', () => {
            isLogin = false;
            isAuthed = false;
            isAdmin = false;
            currentUser = null;
            cart = [];
            // 清除本地存储
            localStorage.removeItem('currentUser');
            localStorage.removeItem('cart');
            guestNav.style.display = 'flex';
            userNav.style.display = 'none';
            adminContainer.style.display = 'none';
            mainContent.style.display = 'block';
            userCenterPage.style.display = 'none';
            renderCart();
            alert('退出成功');
        });

        // 4. 个人中心
        userCenterBtn.addEventListener('click', () => {
            mainContent.style.display = 'none';
            adminContainer.style.display = 'none';
            userCenterPage.style.display = 'block';
        });

        // 5. 实名认证（本地存储）
        document.getElementById('authForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const realName = document.getElementById('authRealName').value.trim();
            const idCard = document.getElementById('authIdCard').value.trim();

            if (!realName || !/^[\u4e00-\u9fa5]{2,8}$/.test(realName)) {
                alert('真实姓名需为2-8位中文');
                return;
            }
            if (!idCard || !/^\d{17}(\d|X|x)$/.test(idCard)) {
                alert('身份证号格式错误');
                return;
            }

            // 更新用户信息
            currentUser.isAuthed = true;
            currentUser.realName = realName;
            currentUser.idCard = idCard;
            isAuthed = true;
            // 更新本地存储的用户列表和当前用户
            const userIndex = users.findIndex(u => u.username === currentUser.username);
            users[userIndex] = currentUser;
            localStorage.setItem('cardNetworkUsers', JSON.stringify(users));
            localStorage.setItem('currentUser', JSON.stringify(currentUser));

            alert('实名认证成功');
            updateLoginStatus();
            // 跳转回商品区
            mainContent.style.display = 'block';
            userCenterPage.style.display = 'none';
        });

        // 6. 购物车相关
        cartBtn.addEventListener('click', () => {
            if (!isLogin) {
                alert('请先登录');
                loginMask.style.display = 'flex';
                return;
            }
            if (!isAuthed) {
                alert('请先完成实名认证');
                mainContent.style.display = 'none';
                userCenterPage.style.display = 'block';
                return;
            }
            cartMask.style.display = 'flex';
        });
        userCartBtn.addEventListener('click', () => {
            cartMask.style.display = 'flex';
        });
        closeCartBtn.addEventListener('click', () => {
            cartMask.style.display = 'none';
        });
        checkoutBtn.addEventListener('click', () => {
            if (cart.length === 0) {
                alert('购物车为空，无法结算');
                return;
            }
            // 生成订单
            const orderId = 'ORDER' + Date.now();
            const order = {
                id: orderId,
                username: currentUser.username,
                products: [...cart],
                totalPrice: cart.reduce((sum, item) => sum + item.price, 0),
                createTime: new Date().toLocaleString(),
                status: 'pending' // pending/paid/canceled
            };
            orders.push(order);
            localStorage.setItem('cardNetworkOrders', JSON.stringify(orders));
            // 清空购物车
            cart = [];
            localStorage.setItem('cart', JSON.stringify(cart));
            renderCart();
            cartMask.style.display = 'none';
            alert(`订单提交成功！订单号：${orderId}`);
        });

        // 绑定商品加入购物车事件
        function bindAddCartEvents() {
            document.querySelectorAll('.add-cart').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.dataset.id;
                    const name = this.dataset.name;
                    const price = parseFloat(this.dataset.price);
                    const img = this.dataset.img;
                    const category = this.dataset.category;

                    // 检查是否已在购物车
                    if (cart.some(item => item.id === id)) {
                        alert('该商品已在购物车中');
                        return;
                    }

                    cart.push({ id, name, price, img, category });
                    localStorage.setItem('cart', JSON.stringify(cart));
                    renderCart();
                    alert('加入购物车成功');
                });
            });
        }

        // 渲染购物车
        function renderCart() {
            // 更新购物车数量徽章
            document.querySelectorAll('.cart-badge').forEach(badge => {
                badge.textContent = cart.length;
            });

            if (cart.length === 0) {
                cartList.innerHTML = `
                    <div style="text-align: center; padding: 50px 0; color: var(--gray-600);">
                        购物车为空，快去选购商品吧～
                    </div>
                `;
                cartTotal.textContent = '0.00';
                return;
            }

            let html = '';
            let total = 0;
            cart.forEach(item => {
                total += item.price;
                html += `
                    <div style="display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee;">
                        <img src="${item.img}" style="width: 60px; height: 40px; object-fit: cover; border-radius: 4px;" alt="${item.name}">
                        <div style="flex: 1; margin-left: 10px;">
                            <div style="font-size: 14px;">${item.name}</div>
                            <div style="font-size: 16px; color: var(--danger); font-weight: 600;">¥${item.price.toFixed(2)}</div>
                        </div>
                        <button class="del-cart" data-id="${item.id}" style="background: transparent; border: none; color: var(--gray-600); cursor: pointer;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
            });
            cartList.innerHTML = html;
            cartTotal.textContent = total.toFixed(2);

            // 绑定删除购物车商品事件
            document.querySelectorAll('.del-cart').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.dataset.id;
                    cart = cart.filter(item => item.id !== id);
                    localStorage.setItem('cart', JSON.stringify(cart));
                    renderCart();
                });
            });
        }

        // 7. 音乐播放器
        uploadMusicBtn.addEventListener('click', () => {
            musicFile.click();
        });
        musicFile.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                audio.src = url;
                alert('音乐文件已选择');
            }
        });
        playMusicBtn.addEventListener('click', () => {
            if (!audio.src) {
                alert('请先选择音乐文件');
                return;
            }
            if (audio.paused) {
                audio.play();
                playMusicBtn.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                audio.pause();
                playMusicBtn.innerHTML = '<i class="fas fa-play"></i>';
            }
        });
        audio.addEventListener('timeupdate', () => {
            const progress = (audio.currentTime / audio.duration) * 100;
            musicProgressFill.style.width = `${progress}%`;
        });
        audio.addEventListener('ended', () => {
            playMusicBtn.innerHTML = '<i class="fas fa-play"></i>';
            musicProgressFill.style.width = '0%';
        });

        // ---------------------- 后台管理功能 ----------------------
        // 切换到后台管理
        adminBtn.addEventListener('click', () => {
            mainContent.style.display = 'none';
            userCenterPage.style.display = 'none';
            adminContainer.style.display = 'block';
        });

        // 后台标签切换
        function bindAdminTabEvents() {
            adminTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    // 切换标签激活状态
                    adminTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    // 切换内容显示
                    adminContents.forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabName}Manage`).classList.add('active');
                });
            });
        }

        // 1. 用户管理 - 渲染用户表格
        function renderUserTable(searchKey = '') {
            let html = '';
            // 过滤用户
            const filteredUsers = users.filter(u => 
                u.username.includes(searchKey) && u.username !== 'admin' // 排除管理员
            );
            if (filteredUsers.length === 0) {
                html = `<tr><td colspan="6" style="text-align: center; padding: 20px;">暂无用户数据</td></tr>`;
            } else {
                filteredUsers.forEach((user, index) => {
                    html += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${user.username}</td>
                            <td>${user.createTime}</td>
                            <td>${user.isAuthed ? '<span class="status-tag status-normal">已认证</span>' : '<span class="status-tag status-pending">未认证</span>'}</td>
                            <td>${user.status === 'normal' ? '<span class="status-tag status-normal">正常</span>' : '<span class="status-tag status-disabled">禁用</span>'}</td>
                            <td class="table-actions">
                                <button class="btn btn-warning" onclick="toggleUserStatus('${user.username}')">${user.status === 'normal' ? '禁用' : '启用'}</button>
                                <button class="btn btn-danger" onclick="deleteUser('${user.username}')">删除</button>
                            </td>
                        </tr>
                    `;
                });
            }
            userTableBody.innerHTML = html;
        }

        // 切换用户状态（启用/禁用）
        window.toggleUserStatus = function(username) {
            const userIndex = users.findIndex(u => u.username === username);
            users[userIndex].status = users[userIndex].status === 'normal' ? 'disabled' : 'normal';
            localStorage.setItem('cardNetworkUsers', JSON.stringify(users));
            renderUserTable(document.getElementById('userSearch').value.trim());
            alert(`用户${username}已${users[userIndex].status === 'normal' ? '启用' : '禁用'}`);
        };

        // 删除用户
        window.deleteUser = function(username) {
            if (confirm(`确定要删除用户${username}吗？`)) {
                users = users.filter(u => u.username !== username);
                localStorage.setItem('cardNetworkUsers', JSON.stringify(users));
                renderUserTable(document.getElementById('userSearch').value.trim());
                alert(`用户${username}已删除`);
            }
        };

        // 搜索用户
        document.getElementById('searchUserBtn').addEventListener('click', () => {
            const searchKey = document.getElementById('userSearch').value.trim();
            renderUserTable(searchKey);
        });

        // 2. 商品管理 - 渲染商品表格
        function renderProductTable(searchKey = '') {
            let html = '';
            // 过滤商品
            const filteredProducts = products.filter(p => p.name.includes(searchKey));
            if (filteredProducts.length === 0) {
                html = `<tr><td colspan="5" style="text-align: center; padding: 20px;">暂无商品数据</td></tr>`;
            } else {
                filteredProducts.forEach(product => {
                    html += `
                        <tr>
                            <td>${product.id}</td>
                            <td>${product.name}</td>
                            <td>${product.category}</td>
                            <td>¥${product.price.toFixed(2)}</td>
                            <td class="table-actions">
                                <button class="btn btn-primary" onclick="editProduct('${product.id}')">编辑</button>
                                <button class="btn btn-danger" onclick="deleteProduct('${product.id}')">删除</button>
                            </td>
                        </tr>
                    `;
                });
            }
            productTableBody.innerHTML = html;
            // 同步渲染前端商品列表
            renderProductGrid();
        }

        // 渲染前端商品列表
        function renderProductGrid() {
            let html = '';
            products.forEach(product => {
                html += `
                    <div class="product-card">
                        <img src="${product.img}" alt="${product.name}" class="product-img">
                        <div class="product-info">
                            <div class="product-name">${product.name}</div>
                            <div class="product-price">¥${product.price.toFixed(2)}</div>
                            <button class="add-cart" data-id="${product.id}" data-name="${product.name}" data-price="${product.price}" data-img="${product.img}" data-category="${product.category}" ${!isAuthed ? 'disabled' : ''}>加入购物车</button>
                        </div>
                    </div>
                `;
            });
            document.getElementById('productGrid').innerHTML = html;
            // 重新绑定加入购物车事件
            bindAddCartEvents();
        }

        // 新增商品
        addProductBtn.addEventListener('click', () => {
            document.getElementById('productModalTitle').textContent = '新增商品';
            document.getElementById('productId').value = '';
            productForm.reset();
            productModal.style.display = 'flex';
        });

        // 编辑商品
        window.editProduct = function(id) {
            const product = products.find(p => p.id === id);
            if (product) {
                document.getElementById('productModalTitle').textContent = '编辑商品';
                document.getElementById('productId').value = product.id;
                document.getElementById('productName').value = product.name;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productImg').value = product.img;
                productModal.style.display = 'flex';
            }
        };

        // 保存商品（新增/编辑）
        productForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const id = document.getElementById('productId').value;
            const name = document.getElementById('productName').value.trim();
            const category = document.getElementById('productCategory').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const img = document.getElementById('productImg').value.trim();

            if (!name || !price || !img) {
                alert('请填写完整商品信息');
                return;
            }

            if (id) {
                // 编辑商品
                const productIndex = products.findIndex(p => p.id === id);
                products[productIndex] = { id, name, category, price, img };
                alert('商品编辑成功');
            } else {
                // 新增商品
                const newId = Date.now().toString();
                products.push({ id: newId, name, category, price, img });
                alert('商品新增成功');
            }

            // 保存到本地存储
            localStorage.setItem('cardNetworkProducts', JSON.stringify(products));
            productModal.style.display = 'none';
            renderProductTable(document.getElementById('productSearch').value.trim());
        });

        // 取消商品操作
        cancelProductBtn.addEventListener('click', () => {
            productModal.style.display = 'none';
        });

        // 删除商品
        window.deleteProduct = function(id) {
            if (confirm('确定要删除该商品吗？')) {
                products = products.filter(p => p.id !== id);
                localStorage.setItem('cardNetworkProducts', JSON.stringify(products));
                renderProductTable(document.getElementById('productSearch').value.trim());
                alert('商品已删除');
            }
        };

        // 搜索商品
        document.getElementById('searchProductBtn').addEventListener('click', () => {
            const searchKey = document.getElementById('productSearch').value.trim();
            renderProductTable(searchKey);
        });

        // 3. 订单管理 - 渲染订单表格
        function renderOrderTable(searchKey = '') {
            let html = '';
            // 过滤订单
            const filteredOrders = orders.filter(order => 
                order.id.includes(searchKey) || order.username.includes(searchKey)
            );
            if (filteredOrders.length === 0) {
                html = `<tr><td colspan="7" style="text-align: center; padding: 20px;">暂无订单数据</td></tr>`;
            } else {
                filteredOrders.forEach(order => {
                    // 简化商品列表显示
                    const productNames = order.products.map(p => p.name).join('、');
                    let statusTag = '';
                    switch(order.status) {
                        case 'pending': statusTag = '<span class="status-tag status-pending">待支付</span>'; break;
                        case 'paid': statusTag = '<span class="status-tag status-paid">已支付</span>'; break;
                        case 'canceled': statusTag = '<span class="status-tag status-canceled">已取消</span>'; break;
                    }
                    html += `
                        <tr>
                            <td>${order.id}</td>
                            <td>${order.username}</td>
                            <td>${productNames}</td>
                            <td>¥${order.totalPrice.toFixed(2)}</td>
                            <td>${order.createTime}</td>
                            <td>${statusTag}</td>
                            <td class="table-actions">
                                <button class="btn btn-primary" onclick="viewOrderDetail('${order.id}')">详情</button>
                            </td>
                        </tr>
                    `;
                });
            }
            orderTableBody.innerHTML = html;
        }

        // 查看订单详情
        window.viewOrderDetail = function(orderId) {
            currentOrderId = orderId;
            const order = orders.find(o => o.id === orderId);
            if (order) {
                let productHtml = '';
                order.products.forEach((p, index) => {
                    productHtml += `
                        <div style="display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee;">
                            <img src="${p.img}" style="width: 80px; height: 50px; object-fit: cover; border-radius: 4px;" alt="${p.name}">
                            <div style="flex: 1; margin-left: 15px;">
                                <div style="font-size: 16px; font-weight: 500;">${index + 1}. ${p.name}</div>
                                <div style="font-size: 14px; color: var(--gray-600);">分类：${p.category}</div>
                            </div>
                            <div style="font-size: 16px; color: var(--danger); font-weight: 600;">¥${p.price.toFixed(2)}</div>
                        </div>
                    `;
                });
                let statusHtml = '';
                switch(order.status) {
                    case 'pending': 
                        statusHtml = `
                            <div style="margin: 20px 0;">
                                <label class="form-label">订单状态</label>
                                <select class="form-select" id="orderStatusSelect" style="max-width: 200px;">
                                    <option value="pending" selected>待支付</option>
                                    <option value="paid">已支付</option>
                                    <option value="canceled">已取消</option>
                                </select>
                            </div>
                        `;
                        break;
                    case 'paid':
                        statusHtml = `
                            <div style="margin: 20px 0;">
                                <label class="form-label">订单状态</label>
                                <select class="form-select" id="orderStatusSelect" style="max-width: 200px;">
                                    <option value="pending">待支付</option>
                                    <option value="paid" selected>已支付</option>
                                    <option value="canceled">已取消</option>
                                </select>
                            </div>
                        `;
                        break;
                    case 'canceled':
                        statusHtml = `
                            <div style="margin: 20px 0;">
                                <label class="form-label">订单状态</label>
                                <select class="form-select" id="orderStatusSelect" style="max-width: 200px;">
                                    <option value="pending">待支付</option>
                                    <option value="paid">已支付</option>
                                    <option value="canceled" selected>已取消</option>
                                </select>
                            </div>
                        `;
                        break;
                }
                document.getElementById('orderDetailContent').innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <div style="font-size: 14px; color: var(--gray-600); margin-bottom: 5px;">订单号：${order.id}</div>
                        <div style="font-size: 14px; color: var(--gray-600); margin-bottom: 5px;">下单用户：${order.username}</div>
                        <div style="font-size: 14px; color: var(--gray-600);">下单时间：${order.createTime}</div>
                    </div>
                    <div style="margin: 20px 0;">
                        <h4 style="margin-bottom: 10px;">商品清单</h4>
                        ${productHtml}
                    </div>
                    <div style="text-align: right; font-size: 18px; font-weight: 600; margin: 20px 0;">
                        订单总价：¥${order.totalPrice.toFixed(2)}
                    </div>
                    ${statusHtml}
                `;
                orderDetailModal.style.display = 'flex';
            }
        };

        // 关闭订单详情
        closeOrderDetailBtn.addEventListener('click', () => {
            orderDetailModal.style.display = 'none';
        });

        // 更新订单状态
        updateOrderStatusBtn.addEventListener('click', () => {
            const newStatus = document.getElementById('orderStatusSelect').value;
            const orderIndex = orders.findIndex(o => o.id === currentOrderId);
            orders[orderIndex].status = newStatus;
            localStorage.setItem('cardNetworkOrders', JSON.stringify(orders));
            orderDetailModal.style.display = 'none';
            renderOrderTable(document.getElementById('orderSearch').value.trim());
            alert('订单状态已更新');
        });

        // 搜索订单
        document.getElementById('searchOrderBtn').addEventListener('click', () => {
            const searchKey = document.getElementById('orderSearch').value.trim();
            renderOrderTable(searchKey);
        });

        // 4. 系统设置 - 初始化
        function initSystemSetting() {
            systemNoticeInput.value = systemConfig.notice;
            defaultDiscount.value = systemConfig.discount;
        }

        // 保存系统设置
        systemSettingForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const notice = systemNoticeInput.value.trim();
            const discount = parseInt(defaultDiscount.value);
            const newPwd = adminNewPwd.value.trim();

            if (notice) {
                systemConfig.notice = notice;
                document.getElementById('systemNotice').textContent = notice;
            }
            if (discount && discount >= 1 && discount <= 100) {
                systemConfig.discount = discount;
            }
            if (newPwd) {
                systemConfig.adminPwd = newPwd;
                // 更新管理员密码
                const adminIndex = users.findIndex(u => u.username === 'admin');
                users[adminIndex].password = newPwd;
                localStorage.setItem('cardNetworkUsers', JSON.stringify(users));
                alert('管理员密码已更新，请重新登录');
                // 强制退出登录
                logoutBtn.click();
            }

            // 保存系统配置
            localStorage.setItem('cardNetworkSystem', JSON.stringify(systemConfig));
            alert('系统设置保存成功');
        });
    </script>
</body>
</html>
